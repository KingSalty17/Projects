<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RA Scheduler Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="dashboard">
        <div class="template-sidebar">
            <h2><i class="fas fa-file-alt"></i> Templates</h2>
            <div class="template-search-container">
                <input type="text" id="templateSearch" placeholder="🔍 Search templates...">
            </div>
            <div id="templateList"></div>
        </div>

        <div class="form-container">
            <div class="poc-search-container">
                <input type="text" id="pocSearch" placeholder="🔍 Search POC by name or position...">
                <div id="pocResults"></div>
            </div>
            
            <div class="selected-poc-card" id="selectedPOC" style="display: none;">
                <div id="pocDetails"></div>
            </div>

            <div id="dynamicForm"></div>
            
            <button class="generate-btn" onclick="generateRA()">
                <i class="fas fa-magic"></i> Generate RA
            </button>

            <div class="output-preview-container">                
                <button class="clear-btn" onclick="clearOutput()">Clear</button>
                <button class="copy-btn" onclick="copyOutput()">Copy</button>
                <div class="output-preview" id="outputPreview"></div>
            </div>
                

        </div>
    </div>

    
    <script src="pocList.js"></script>
    <script src="templates.js"></script>
    <script src="tempConfigs.js"></script>
    <script src="tempHelpers.js"></script>
    <script src="pocSearch.js"></script>
   

    <script>
        
        // Initialize application
        function initApp() {
            populateTemplates();
            setupPOCSearch();
            setupTemplateSearch();
            initAutocomplete(); 
        }

        function populateTemplates() {
    const templateList = document.getElementById('templateList');

    // Group templates into categories
    const categorizedTemplates = {
        "HABC Templates": {
            haCleanout: "HABC Cleanout",
            haEviction: "HABC Eviction",
            haRelocation: "HABC Relocation",            
            haBoxDelivery: "HABC Box Delivery",
            haTruckUnload: "HABC Truck Unload"
        },
        "Housing Commission Template": {
            hocRelocation: "HOC Relocation"
        },
        "School Templates": {
            schoolMoving: "School Moving",
            schoolPickupDelivery: "School Pickup & Delivery"
        },
        "Private Sector Templates": {
            privateRelocation: "Private Relocation",
            chamberRelocation: "Chamber Relocation"
        },
        "State's Attorney Templates": {
            saRelocation: "SA Relocation",
            saFurnitureRemoval: "SA Furniture Removal"
        },
        "University Template": {
            universityRelocation: "University Relocation"
        },
        
        "Aging Services Template": {
            agingRelocation: "Aging Relocation"
        },
        
        "Non-Profit Templates": {
            grassrootsRelocation: "Grassroots Relocation"
        },
               
        "Project Management Template": {
            jacobsRelocation: "Jacobs Relocation"
        }
    };

    // Create collapsible sections for each category
    Object.keys(categorizedTemplates).forEach(category => {
        const categoryDiv = document.createElement('div');
        categoryDiv.className = 'template-category';

        const categoryHeader = document.createElement('h3');
        categoryHeader.textContent = category;
        categoryHeader.className = 'category-header';
        categoryHeader.addEventListener('click', () => {
            const templatesDiv = categoryDiv.querySelector('.templates');
            templatesDiv.style.display = templatesDiv.style.display === 'none' ? 'block' : 'none';
        });

        const templatesDiv = document.createElement('div');
        templatesDiv.className = 'templates';
        templatesDiv.style.display = 'none';

        // Add templates to the category
        const templates = categorizedTemplates[category];
        Object.keys(templates).forEach(key => {
            const card = document.createElement('div');
            card.className = 'template-card';
            card.textContent = templates[key];
            card.addEventListener('click', () => selectTemplate(key));
            templatesDiv.appendChild(card);
        });

        categoryDiv.appendChild(categoryHeader);
        categoryDiv.appendChild(templatesDiv);
        templateList.appendChild(categoryDiv);
    });
}

     

        function createFormFields(templateKey) {
    const dynamicForm = document.getElementById('dynamicForm');
    dynamicForm.innerHTML = '';

    // Remove the hardcoded templateConfigs object and use the external one
    if (templateConfigs[templateKey]) {
        dynamicForm.innerHTML = templateConfigs[templateKey];
    } else {
        // Keep the existing fallback logic
        const placeholders = getPlaceholders(templates[templateKey]);
        placeholders.forEach(placeholder => {
            if (['firstName', 'lastName', 'phone', 'email', 'organization', 'position'].includes(placeholder)) return;
            
            const group = document.createElement('div');
            group.className = 'input-group';
            const defaultValue = placeholder.toLowerCase() === 'time' ? '9:00 am' : '';
            group.innerHTML = `
                <label>${formatLabel(placeholder)}</label>
                <input type="text" 
                    id="${placeholder}" 
                    placeholder="Enter ${formatLabel(placeholder)}"
                    value="${defaultValue}">
            `;
            dynamicForm.appendChild(group);
        });
    }
    // Initialize autocomplete for address fields
    const addressFields = ['location', 'fromAddress', 'toAddress'];
            addressFields.forEach(fieldId => {
                const input = document.getElementById(fieldId);
                if (input) {
                    createAutocomplete(input);
                }
         });
}

function createAutocomplete(inputElement) {
            const autocomplete = new google.maps.places.Autocomplete(
                inputElement,
                {
                    types: ['address'],
                    componentRestrictions: { 'country': ['US'] },
                    fields: ['address_components', 'formatted_address']
                }
            );

            autocomplete.addListener('place_changed', () => {
                const place = autocomplete.getPlace();
                const formattedAddress = formatAddress(place);
                if (formattedAddress) {
                    inputElement.value = formattedAddress;
                }
            });
        }

        function formatAddress(place) {
            if (!place.address_components) return null;
            
            const components = place.address_components;
            const address = getComponent(components, 'street_number') + ' ' + 
                          getComponent(components, 'route');
            const city = getComponent(components, 'locality') || 
                       getComponent(components, 'sublocality');
            const state = getComponent(components, 'administrative_area_level_1', 'short_name');
            const zip = getComponent(components, 'postal_code');

            return `${address} | ${city}, ${state} ${zip}`;
        }

        function getComponent(components, type, nameType = 'long_name') {
            const component = components.find(c => c.types.includes(type));
            return component ? component[nameType] : '';
        }


        function generateRA() {
    if (!selectedTemplate || !selectedPOC) {
        alert('Please select a template and POC first!');
        return;
    }

    let content = templates[selectedTemplate];
    const placeholders = getPlaceholders(content);

    placeholders.forEach(placeholder => {
        let value = '';

        // Check if the placeholder should come from the form input
        const input = document.getElementById(placeholder);
        if (input) {
            value = input.value; // Prioritize form input values
        } else if (selectedPOC[placeholder]) {
            // Use POC values only if no form input exists for the placeholder
            value = selectedPOC[placeholder];
        }

        // Special handling for time field
        if (placeholder === 'time' && !value) {
            value = '9:00 am';
        }

        // Clean replacement with fallback
        if (value) {
            content = content.replaceAll(`[${placeholder}]`, value);
        } else {
            content = content.replaceAll(`[${placeholder}]`, '');
        }
    });

    // Additional cleanup
    content = content.replace(/\s*\|\s*\|\s*/g, ' | ')
                     .replace(/\s*\|\s*$/g, '')
                     .replace(/^\s*\|\s*/g, '')
                     .replace(/\s*\|\s*(?=\|)/g, '');

    document.getElementById('outputPreview').innerHTML = content.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');

    // Show the copy and clear buttons
    updateCopyButtonVisibility();
}

        window.addEventListener('DOMContentLoaded', initApp);
    </script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAaklQ25brP4vxErpP1MT-4OAeZBsqqODE&libraries=places&callback=initAutocomplete" async defer>
</script> 
</body>
</html>
